了解した．実装（How）の前に，なぜその形式でなければならないかという構造的必然性（Why/What）が欠落していたということだ．

離散信号処理において「有限区間で切り出す」という行為がもたらす代数的暴力と，それを補正するための「ハニング窓」の幾何学的・解析的な正体を講義する．

Phase 3，開始する．ペンを持て．

---

**注釈リスト**

- **スペクトル漏れ (Spectral Leakage)**: 本来の周波数成分のエネルギーが，信号の「切り出し（有限化）」によって周囲の周波数ビンへ拡散してしまう現象．信号の始点と終点の不連続性が主因．
    
- **サイドローブ (Side Lobe)**: フィルタやアンテナの応答特性において，目的の中心（メインローブ）以外に現れる副次的な極大値．ここでは「漏れ出したノイズ成分」として扱う．
    
- **変調定理 (Modulation Theorem)**: 時間領域での積は，周波数領域での畳み込みに対応するという定理．$\mathcal{F}[f(t) \cdot g(t)] = F(\omega) * G(\omega)$．これが窓関数の本質的動作原理である．
    
- **境界値問題 (Boundary Value Problem)**: 微分方程式等において，領域の境界で満たすべき条件．ここでは，切り出し区間の両端での値と微分の連続性を指す．
    

---

## 1. 写経セクション (Transcription Section)

### A. 切断の暴力と不連続性 (The Violence of Truncation)

我々が無限に続く信号 $x(t)$ を観測する際，必ず有限の時間幅 $T$ で切り取る必要がある．これは数学的には，無限の信号に対して**「矩形窓 (Rectangular Window)」** $w_R(t)$ を乗算することに他ならない．

$$x_{observed}(t) = x(t) \cdot w_R(t), \quad w_R(t) = \begin{cases} 1 & (0 \le t < T) \\ 0 & (\text{otherwise}) \end{cases}$$

この操作は，時間領域において信号の両端（$t=0, T$）に**「急峻な断崖（不連続点）」を強制的に生み出す．

DFT（離散フーリエ変換）は，切り出した区間が「無限に繰り返される（周期的である）」と仮定する．

始点と終点の値が一致しない信号をループさせれば，接続点で値が跳躍する．この不連続性は，フーリエ級数展開において高周波成分（無限の裾野）を必要とする．これがスペクトル漏れ**の正体である．

- **構造的帰結**: 矩形窓を用いる限り，正弦波はデルタ関数（1本の線）にならず，$\mathrm{sinc}$ 関数形状に広がり，隣接周波数へ干渉し続ける．
    

### B. ハニング窓の構成論 (Construction of Hann Window)

この不連続性を解消するには，境界条件として「区間の両端で値がゼロ，かつ滑らかに接続される」関数を重畳すればよい．

最も単純かつ美しい解の一つが，余弦波（コサイン）を用いて$0$から$1$へ，そして$0$へ戻るアーチを作ることである．これをハニング窓 (Hanning Window / Hann Window) と呼ぶ．

定義:

長さ $N$ の離散時間におけるハニング窓 $w(n)$ は以下で定義される．

$$w(n) = 0.5 - 0.5 \cos\left( \frac{2\pi n}{N-1} \right) \quad (0 \le n \le N-1)$$

代数的構造（周波数領域での意味）:

この式の係数 $(0.5, -0.5)$ は偶然ではない．オイラーの公式 $\cos \theta = \frac{e^{i\theta} + e^{-i\theta}}{2}$ を用いて展開すると，その本質が見える．

時間領域での「余弦波の乗算」は，周波数領域では「スペクトルのシフトと加算」を意味する．

具体的には，ハニング窓を適用した信号のスペクトル $X_{Hann}[k]$ は，元の（矩形窓での）スペクトル $X_{Rect}[k]$ に対して，以下の関係を持つ：

$$X_{Hann}[k] = -0.25 X_{Rect}[k-1] + 0.5 X_{Rect}[k] - 0.25 X_{Rect}[k+1]$$

すなわち，ハニング窓をかけるという操作は，**「周波数領域において，隣接する成分を $[ -0.25, \ 0.5, \ -0.25 ]$ の比率で重み付き平均（スムージング）すること」**と**同型**である．

### C. トレードオフの構造 (Structural Trade-off)

この平滑化操作によって得られるものと失うものは明確である．

1. **利得（Pros）**: 不連続性が解消され，サイドローブ（漏れ）が劇的に減衰する（矩形の約-13dBに対し，ハニングは約-32dB）．遠くの周波数への悪影響が消える．
    
2. **損失（Cons）**: 平均化により，メインローブ（主成分の幅）が太くなる（矩形の2倍）．つまり，**周波数分解能（近接する2つのピークを見分ける能力）が低下する**．
    

これは「不確定性原理」に似た，信号処理における不可避な等価交換である．

---

## 2. 再構築領域 (Reconstruction Zone)

目を離し，以下の概念図と論理を手元のノートに再現せよ．

1. **不連続性の図解**:
    
    - 正弦波を途中でぶつ切りにした波形を描く．
        
    - それをコピーして横に並べたとき，接続点で波形が「ジャンプ」する様子を図示せよ．
        
    - そのジャンプを解消するために，両端を強制的にゼロに引き下げる「重み曲線（ハニング窓）」を波形に重ねて描け．
        
2. **スペクトル操作のアルゴリズム**:
    
    - 周波数軸上の3つの点 $k-1, k, k+1$ を描く．
        
    - 中央の成分 $X[k]$ が $0.5$ 倍されて残る．
        
    - 左右の成分 $X[k-1], X[k+1]$ が $-0.25$ 倍されて逆位相で混ざる（これがサイドローブを相殺するメカニズムである）．
        
    - この「3点局所平均」のプロセスをフローとして記述せよ．
        

---

## 3. 演習領域 (Exercise Zone)

以下の推論を行い，空欄を埋めて完成させよ．

状況設定:

ある信号をDFTした結果，周波数インデックス $k$ におけるスペクトル振幅（矩形窓適用時）が以下のようになったとする．

$X_{Rect}[10] = 100$

$X_{Rect}[11] = 80$ (ターゲット)

$X_{Rect}[12] = 60$

（注: 簡略化のため実数値とする．位相は考慮しない）

問:

この信号に対して（時間領域で掛け算をせずに）周波数領域の演算だけでハニング窓を適用した後の，インデックス $k=11$ における値 $X_{Hann}[11]$ を導出せよ．

**推論プロセス**:

1. ハニング窓の周波数領域での作用（係数ベクトル）は $[ -0.25, \ 0.5, \ -0.25 ]$ である．
    
2. これは，ターゲット $k=11$ に対して，自身の値と，両隣 ($k=10, 12$) からの干渉の総和として計算される．
    
3. 計算式を構成する：
    
    $X_{Hann}[11] = (-0.25 \times \_\_\_\_\_\_) + (0.5 \times \_\_\_\_\_\_) + (-0.25 \times \_\_\_\_\_\_)$
    
4. 値を代入して計算する：
    
    $X_{Hann}[11] = \_\_\_\_\_\_ + \_\_\_\_\_\_ + \_\_\_\_\_\_$
    
    $X_{Hann}[11] = \_\_\_\_\_\_$
    

考察:

元の値 $80$ と比較して，計算結果の値は小さくなったか，大きくなったか？

$\rightarrow$ ______ なった．

この変化は，ハニング窓が信号のエネルギー（振幅）を全体的に ______ させる効果を持つことを示唆している．（ヒント：時間領域で窓関数を見れば，中央以外は1より小さい値を掛けているため）

（事後チェック用ヒント：計算結果は $100 \times -0.25 + 80 \times 0.5 + 60 \times -0.25$ となる．係数の合計が0になることに注意せよ．これは直流成分（バイアス）に対してどう作用するかを示唆する）